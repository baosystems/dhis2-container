## DO NOT EDIT
## Template managed by Remco.

## DHIS 2.37 Configuration File
## Reference: https://docs.dhis2.org/en/manage/performing-system-administration/dhis-core-version-237/installation.html#install_dhis2_configuration_reference


# ----------------------------------------------------------------------
# Server
# https://docs.dhis2.org/en/manage/performing-system-administration/dhis-core-version-237/installation.html#install_database_configuration
# ----------------------------------------------------------------------

# Base URL to the DHIS 2 instance; default is unset
{% if exists("/dhis2/server/baseurl") %}
server.base.url = {{ getv("/dhis2/server/baseurl") }}
{% else %}
#server.base.url =
{% endif %}

# Enable secure settings if system is deployed on HTTPS; default is 'off'
{% if exists("/dhis2/server/https") %}
server.https = {{ getv("/dhis2/server/https") }}
{% else %}
#server.https = off
{% endif %}


# ----------------------------------------------------------------------
# Database connection for PostgreSQL
# https://docs.dhis2.org/en/manage/performing-system-administration/dhis-core-version-237/installation.html#install_database_configuration
# ----------------------------------------------------------------------

# Hibernate SQL dialect; default is unset
{% if exists("/dhis2/connection/dialect") %}
connection.dialect = {{ getv("/dhis2/connection/dialect") }}
{% else %}
connection.dialect = org.hibernate.dialect.PostgreSQLDialect
{% endif %}

# JDBC driver class; default is unset
{% if exists("/dhis2/connection/driverclass") %}
connection.driver_class = {{ getv("/dhis2/connection/driverclass") }}
{% else %}
connection.driver_class = org.postgresql.Driver
{% endif %}

# Database connection URL; default is unset
{% if exists("/dhis2/connection/url") %}
connection.url = {{ getv("/dhis2/connection/url") }}
{% elif exists("/database/host") %}
connection.url = jdbc:postgresql://{{ getv("/database/host") }}:{{ getv("/database/port", "5432") }}/{{ getv("/database/dbname", "dhis2") }}
{% else %}
connection.url = jdbc:postgresql:{{ getv("/database/dbname", "dhis2") }}
{% endif %}

# Database username; default is unset
{% if exists("/dhis2/connection/username") %}
connection.username = {{ getv("/dhis2/connection/username") }}
{% else %}
connection.username = {{ getv("/database/username", "dhis") }}
{% endif %}

# Database password (sensitive); default is unset
{% if exists("/dhis2/connection/password") %}
connection.password = {{ getv("/dhis2/connection/password") }}
{% elif exists("/database/password") %}
connection.password = {{ getv("/database/password") }}
{% else %}
#connection.password =
{% endif %}

# Database schema behavior, can be 'validate', 'update', 'create', 'create-drop'; default is unset
{% if exists("/dhis2/connection/schema") %}
connection.schema = {{ getv("/dhis2/connection/schema") }}
{% else %}
connection.schema = update
{% endif %}

# Max size of connection pool; default is '80'
{% if exists("/dhis2/connection/pool/maxsize") %}
connection.pool.max_size = {{ getv("/dhis2/connection/pool/maxsize") }}
{% else %}
#connection.pool.max_size = 80
{% endif %}


# ----------------------------------------------------------------------
# Redis caching
# https://docs.dhis2.org/en/manage/performing-system-administration/dhis-core-version-237/installation.html#install_cluster_configuration_redis
# ----------------------------------------------------------------------

# Use or disable Redis; default is 'false'
{% if gets("/redis/*") %}
redis.enabled = true
{% else %}
#redis.enabled = false
{% endif %}

# Specifies where the redis server is running; default is 'localhost'
{% if exists("/redis/host") %}
redis.host = {{ getv("/redis/host") }}
{% else %}
#redis.host = localhost
{% endif %}

# Specifies the port in which the redis server is listening; default is '6379'
{% if exists("/redis/port") %}
redis.port = {{ getv("/redis/port", "6379") }}
{% else %}
#redis.port = 6379
{% endif %}

# Specifies the authentication password; default is unset
{% if exists("/redis/password") %}
redis.password = {{ getv("/redis/password") }}
{% else %}
#redis.password =
{% endif %}

# Specifies whether the Redis server has SSL enabled; default is 'false'
{% if exists("/redis/usessl") %}
redis.use.ssl = true
{% else %}
#redis.use.ssl = false
{% endif %}

# Set how frequently the leader election needs to occur and how long it would take for another instance
# to take over as the leader after the previous leader has become unavailable; default is '2'
{% if exists("/redis/leaderttl") %}
leader.time.to.live.minutes = {{ getv("/redis/leaderttl") }}
{% else %}
#leader.time.to.live.minutes = 2
{% endif %}


# ----------------------------------------------------------------------
# Encryption
# https://docs.dhis2.org/en/manage/performing-system-administration/dhis-core-version-237/installation.html#install_encryption_configuration
# ----------------------------------------------------------------------

# Encryption password (sensitive); default is unset
{% if exists("/dhis2/encryption/password") %}
encryption.password = {{ getv("/dhis2/encryption/password") }}
{% else %}
#encryption.password =
{% endif %}


# ----------------------------------------------------------------------
# File store
# https://docs.dhis2.org/en/manage/performing-system-administration/dhis-core-version-237/installation.html#install_file_store_configuration
# ----------------------------------------------------------------------

# File store provider, currently 'filesystem' and 'aws-s3' are supported; default is 'filesystem'
{% if exists("/dhis2/filestore/provider") %}
filestore.provider = {{ getv("/dhis2/filestore/provider") }}
{% else %}
#filestore.provider = filesystem
{% endif %}

# Directory / S3 bucket name, folder below DHIS2_HOME on file system, 'bucket' on AWS S3; default is 'files'
{% if exists("/dhis2/filestore/container") %}
filestore.container = {{ getv("/dhis2/filestore/container") }}
{% else %}
#filestore.container = files
{% endif %}

# The following configuration is applicable to cloud storage only (AWS S3)

# Datacenter location / AWS Region (not required); default is unset
{% if exists("/dhis2/filestore/location") %}
filestore.location = {{ getv("/dhis2/filestore/location") }}
{% else %}
#filestore.location =
{% endif %}

# Public identity / AWS IAM Access Key ID / username; default is unset
{% if exists("/dhis2/filestore/identity") %}
filestore.identity = {{ getv("/dhis2/filestore/identity") }}
{% else %}
#filestore.identity =
{% endif %}

# Secret key / AWS IAM Secret Access Key / password (sensitive); default is unset
{% if exists("/dhis2/filestore/secret") %}
filestore.secret = {{ getv("/dhis2/filestore/secret") }}
{% else %}
#filestore.secret =
{% endif %}


# ----------------------------------------------------------------------
# Clustering
# https://docs.dhis2.org/en/manage/performing-system-administration/dhis-core-version-237/installation.html#install_cluster_configuration
# ----------------------------------------------------------------------

# Hostname for this web server; default is unset
{% if exists("/dhis2/cluster/hostname") %}
cluster.hostname = {{ getv("/dhis2/cluster/hostname") }}
{% elif exists("/service/name") and exists("/system/ip") %}
cluster.hostname = {{ getv("/system/ip") }}
{% else %}
#cluster.hostname =
{% endif %}

# Port for cache listener; default is '4001'
{% if exists("/dhis2/cluster/cache/port") %}
cluster.cache.port = {{ getv("/dhis2/cluster/cache/port") }}
{% else %}
#cluster.cache.port = 4001
{% endif %}

# Port for remote object cache listener; default is '0'
{% if exists("/cluster/cache/remote/object/port") %}
cluster.cache.remote.object.port = {{ getv("/cluster/cache/remote/object/port") }}
{% elif exists("/dhis2/cluster/hostname") or (exists("/service/name") and exists("/system/ip")) %}
cluster.cache.remote.object.port = 5001
{% else %}
#cluster.cache.remote.object.port = 0
{% endif %}

# List of Host:port participating in the cluster; default is unset
{% if exists("/dhis2/cluster/members") %}
cluster.members = {{ getv("/dhis2/cluster/members") }}
{% elif exists("/service/name") and exists("/system/ip") %}
cluster.members ={{ printf("%s", " ") }}{% for ip in lookupIP(getv("/service/name")) %}{% if ip != getv("/system/ip") %}{{ ip }}:{{ getv("/dhis2/cluster/cache/port", "4001") }},{% endif %}{% endfor %}

{% else %}
#cluster.members =
{% endif %}

# Node identifier, optional, useful in clusters; default is unset
{% if exists("/dhis2/node/id") %}
node.id = {{ getv("/dhis2/node/id") }}
{% elif exists("/system/fqdn") %}
node.id = {{ getv("/system/fqdn") }}
{% else %}
#node.id =
{% endif %}


# ----------------------------------------------------------------------
# Log file configuration
# https://docs.dhis2.org/en/manage/performing-system-administration/dhis-core-version-237/installation.html#log-configuration
# ----------------------------------------------------------------------

# Max size for log files; default is '100MB'
{% if exists("/dhis2/logging/file/maxsize") %}
logging.file.max_size = {{ getv("/dhis2/logging/file/maxsize") }}
{% else %}
#logging.file.max_size = 100MB
{% endif %}

# Max number of rolling log archive files; default is '1'
{% if exists("/dhis2/logging/file/maxarchives") %}
logging.file.max_archives = {{ getv("/dhis2/logging/file/maxarchives") }}
{% else %}
#logging.file.max_archives = 1
{% endif %}


# ----------------------------------------------------------------------
# Monitoring
# https://docs.dhis2.org/en/manage/performing-system-administration/dhis-core-version-237/installation.html#monitoring
# ----------------------------------------------------------------------

# DHIS2 API monitoring; default is 'off'
{% if exists("/dhis2/monitoring/api/enabled") %}
monitoring.api.enabled = {{ getv("/dhis2/monitoring/api/enabled") }}
{% else %}
#monitoring.api.enabled = off
{% endif %}

# JVM monitoring; default is 'off'
{% if exists("/dhis2/monitoring/jvm/enabled") %}
monitoring.jvm.enabled = {{ getv("/dhis2/monitoring/jvm/enabled") }}
{% else %}
#monitoring.jvm.enabled = off
{% endif %}

# Database connection pool monitoring; default is 'off'
{% if exists("/dhis2/monitoring/dbpool/enabled") %}
monitoring.dbpool.enabled = {{ getv("/dhis2/monitoring/dbpool/enabled") }}
{% else %}
#monitoring.dbpool.enabled = off
{% endif %}

# Hibernate monitoring, do not use in production; default is 'off'
{% if exists("/dhis2/monitoring/hibernate/enabled") %}
monitoring.hibernate.enabled = {{ getv("/dhis2/monitoring/hibernate/enabled") }}
{% else %}
#monitoring.hibernate.enabled = off
{% endif %}

# Uptime monitoring; default is 'off'
{% if exists("/dhis2/monitoring/uptime/enabled") %}
monitoring.uptime.enabled = {{ getv("/dhis2/monitoring/uptime/enabled") }}
{% else %}
#monitoring.uptime.enabled = off
{% endif %}

# CPU monitoring; default is 'off'
{% if exists("/dhis2/monitoring/cpu/enabled") %}
monitoring.cpu.enabled = {{ getv("/dhis2/monitoring/cpu/enabled") }}
{% else %}
#monitoring.cpu.enabled = off
{% endif %}


# ----------------------------------------------------------------------
# System telemetry
# ----------------------------------------------------------------------

# System monitoring URL; default is unset
{% if exists("/dhis2/system/monitoring/url") %}
system.monitoring.url = {{ getv("/dhis2/system/monitoring/url") }}
{% else %}
#system.monitoring.url =
{% endif %}

# System monitoring username; default is unset
{% if exists("/dhis2/system/monitoring/username") %}
system.monitoring.username = {{ getv("/dhis2/system/monitoring/username") }}
{% else %}
#system.monitoring.username =
{% endif %}

# System monitoring password (sensitive); default is unset
{% if exists("/dhis2/system/monitoring/password") %}
system.monitoring.password = {{ getv("/dhis2/system/monitoring/password") }}
{% else %}
#system.monitoring.password =
{% endif %}


# ----------------------------------------------------------------------
# Changelog
# https://docs.dhis2.org/en/manage/performing-system-administration/dhis-core-version-237/installation.html#install_changelog
# ----------------------------------------------------------------------

# Aggregate changelog; default is 'on'
{% if exists("/dhis2/changelog/aggregate") %}
changelog.aggregate = {{ getv("/dhis2/changelog/aggregate") }}
{% else %}
#changelog.aggregate = on
{% endif %}

# Tracker changelog; default is 'on'
{% if exists("/dhis2/changelog/tracker") %}
changelog.tracker = {{ getv("/dhis2/changelog/tracker") }}
{% else %}
#changelog.tracker = on
{% endif %}


# ----------------------------------------------------------------------
# Auditing
# ----------------------------------------------------------------------
{% if getv("/dhis2/build/major", "")|cut:"." >= "236" %}
{# The system.audit.enabled option was added in 2.36 #}
# Default is 'true'
{% if exists("/dhis2/system/audit/enabled") %}
system.audit.enabled = {{ getv("/dhis2/system/audit/enabled") }}
{% else %}
#system.audit.enabled = true
{% endif %}
{% endif %}

# Default is 'off'
{% if exists("/dhis2/audit/logger") %}
audit.logger = {{ getv("/dhis2/audit/logger") }}
{% else %}
#audit.logger = off
{% endif %}

# Default is 'on'
{% if exists("/dhis2/audit/database") %}
audit.database = {{ getv("/dhis2/audit/database") }}
{% else %}
#audit.database = on
{% endif %}

# Default is unset
{% if exists("/dhis2/audit/metadata") %}
audit.metadata = {{ getv("/dhis2/audit/metadata") }}
{% else %}
#audit.metadata =
{% endif %}

# Default is unset
{% if exists("/dhis2/audit/tracker") %}
audit.tracker = {{ getv("/dhis2/audit/tracker") }}
{% else %}
#audit.tracker =
{% endif %}

# Default is unset
{% if exists("/dhis2/audit/aggregate") %}
audit.aggregate = {{ getv("/dhis2/audit/aggregate") }}
{% else %}
#audit.aggregate =
{% endif %}


# ----------------------------------------------------------------------
# End of template
# ----------------------------------------------------------------------


{% if exists("/dhis2/unspecified") %}
# Unspecified settings

{{ getv("/dhis2/unspecified") }}
{% endif %}
